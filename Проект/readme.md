# Проектная работа

# Структура сети

## Общая схема:

   Мы имеем 3 провайдера, основной офис, дата-центр и два небольших удаленных офиса. Общая схема следующая:

![](screenshots/2021-06-05-17-50-14-image.png)

   Можем ли мы разделить автономную систему 9001 на 2 географические области?

   Далее подробнее распишем каждый структурный участок.

## Сеть из 3 провайдеров.

![](screenshots/2021-06-05-17-33-50-image.png)

1. Каждый провайдер имеет свою автономную систему.

2. Внутри автономных систем находятся маршутизаторы, которые обеспечивают отказоустойчивость.

3. Для внутренней связи используется протокол динамической маршрутизации IS-IS.

## Сеть центрального офиса компании GrowWide.

![](screenshots/2021-06-05-17-34-28-image.png)

1. Компания владеет своей автономной системой.

2. Ядро сети подключено к провайдерам. Реализована отказоустойчивость.

3. К ядру сети подключены маршутизаторы распределения.

4. К маршрутизаторам распределения подключены L3-коммутаторы доступа.

5. В рамках сети действует протокол OSPF.

6. Site-to-site VPN.

7. VPN-шлюз Remote-Access VPN.

## Сеть в дата-центре

![](screenshots/2021-06-05-17-46-36-image.png)

1. Подключение через двух провайдеров.

2. DMZ-сеть для серверов.

3. Site-to-Site VPN.

## Сеть необольшого регионального офиса без автономной системы.

![](screenshots/2021-06-05-17-47-46-image.png)

1. Выход через два линка. 
2. Site-to-Site VPN.

## Сеть еще одного небольшого офиса с уже использующейся в остальной сети адресацией.

![](screenshots/2021-06-05-17-48-07-image.png)

1. Реализация случая, когда нужно объединить в подсети с одинаковой адресацией.

2. Лучший вариант - адресацию поменять, но для работы реализуем такой экстренный сценарий.

3. Site-to-Site VPN. 

## DHCP

1. Вариант 1. Сделать централизованный DHCP-сервер.
   
   1. При потере связи с центральным офисом клиенты в регионах не получат адресов.
   
   2. Если в регионах использовать резервные DHCP на период недоступности центрального офиса - возможны конфликты адресов. Часть адресов будет получена из центра, часть от сервера.
   
   3. Выход - выдавать из разных диапазонов. Например диапазоны 1-126/24; 129-254/24.
   
   4. В этом случае в регионах по умолчанию DHCP отключен. Отслеживается основной DHCP и при его недоступности включается резервный.
   
   5. Вариант для курсовой интересный.

2. Альтернативынй вариант 2. В каждом офисе свой DHCP-сервер.
   
   1. Нет зависимости от внешних каналов.
   
   2. Нет центральной точки со всей информацией.
   
   3. Но можно реализовать сбор через центральный SYSLOG-сервер.

# Этапы достижения результата

1. Формирование схемы всей сети.

2. Адресация устройств, сегментов.

3. Назначение сетевым устройставам адресов управления.

4. Настройка устройств провайдеров.

5. Настройка устройств центрального офиса.

6. Настройка устройств дата-центра.

7. Разрешение для управления только через определенные интерфейсы и с определенных устройств.

# Реализация

## Планирование адресного пространства

Начнем формировать адресацию. Точкой отсчета возмем центральный офис.

![](screenshots/2021-06-05-20-19-57-image.png)

### Исходные данные

- В работе максимально отойдем от использования L2.

- К каждому коммутатору доступа будет подключаться несколько сетей (отделов).

- На коммутаторе эти сети должны суммаризовываться, т.о. количество маршрутов в сети значительно снизится.

- Исходные данные:
  
  - Центральный офис занимает 10 этажей.
  
  - На каждом этаже 100 рабочих мест.
    
    - Для подключения рабочих мест на этаже установлено 5 коммутаторов доступа (24 порта) и 1 коммутатор распределения.
    
    - Коммутаторы доступа подключены к коммутатору распределения на этаже и к коммутатору распределения на соседнем этаже.

### Визуализация для определения размера сетей

- На схеме ниже приведена разбивка сети на подсети коммутаторов доступа, подсети отделов (подключаются к коммутаторам доступа) и хосты одного из отделов. Пока что нас интересует именно суммаризация и разбиение клиентской сети. Избыточные линки между коммутаторами не показаны, чтобы не загромождать рисунок, они не участвуют в суммаризации. Подробное описание следует за схемой. 

![](screenshots/2021-06-09-21-14-02-image.png)

- Поскольку установлено 50 коммутаторов доступа, у нас будет 50 сетей, которые анонсируют эти коммутаторы. Заложим преспективу масштабирования в два раза. Получим 100 коммутаторов, "округлим" это значение до 128 для более удобного планирования адресного пространства. Т.е. чтобы уникально идентифицировать каждую суммарную сеть, нам нужно 7 бит.

- Спускаемся далее и рассмотрим, сколько клиентских сетей может "скрываться" за одним коммутатором. Поскольку к коммутатору может быть подключен любой отдел, то количество подключаемых сетей определяется количеством отделов. Будем считать, что мы имеет 64 отдела, но заложим избыточность и увеличим их число до 128. Т.о. чтобы идентифицировать каждую минимальную сеть за коммутатором, нам нужно 7 бит.

- Осталось определить количество хостов в минимальной сети. Поскольку у нас коммутаторы доступа имеют 24 порта, то максимум подключаемых к нему хостов условно 20. Забегая вперед, увеличим это число в 2 раза, чтобы реализовать DHCP-отказоустойчивость на двух DHCP-серверах. Таким образом, число адресов в одной подсети составляет 64. Для идентификации хоста нужно 6 бит.

Переходим к формированию результата. 6 бит на хост + 7 бит на сеть отдела в одном коммутаторе + 7 бит на идентификацию коммутатора. Получаем 20 бит. Сеть с маской 32-20=12 бит полностью опишет клиентские подключения. Нам потребуются еще сети для назначения loopback-адресов, создания линков между сетевыми устройствами. Поэтому маску с 12 бит мы меняем на 11.

### Таблица адресов клиентских подсетей

Исходя из маски 11 бит выберем сеть 10.192.0.0/11. Она находится не в начале дипазона (будем надеяться, что при подключении "чужих" сетей это снизит вероятность совпадения адресов), также после этой сети остается еще одна такая же, что в случае чего позволит выполнить суммаризацию до маски 10. Имеем диапазон адесов 10.192.0.0 - 10.223.255.255.

Приступаем к определению клиентских подсетей. Под них выделена сеть 10.192.0.0/12. Диапазон 10.192.0.0-10.207.255.255.

---

Из этой сети мы выделяем 128 подсетей для 128 коммутаторов. Маска 19.

Тогда получим следующую адресацию для суммарных подсетей за коммутаторами:

|                | Диапазон адресов            | Маска |
| -------------- | --------------------------- | ----- |
| Коммутатор 1   | 10.192.0.0-10.192.31.255    | 19    |
| Коммутатор 2   | 10.192.32.0-10.192.63.255   | 19    |
| Коммутатор 3   | 10.192.64.0-10.192.95.255   | 19    |
| Коммутатор 4   | 10.192.96.0-10.192.127.255  | 19    |
| Коммутатор 5   | 10.192.128.0-10.192.159.255 | 19    |
| Коммутатор 6   | 10.192.160.0-10.192.191.255 | 19    |
| Коммутатор 7   | 10.192.192.0-10.192.223.255 | 19    |
| Коммутатор 8   | 10.192.224.0-10.192.255.255 | 19    |
| ---            | ---                         | ---   |
| Коммутатор 121 | 10.207.0.0-10.207.31.255    | 19    |
| Коммутатор 122 | 10.207.32.0-10.207.63.255   | 19    |
| Коммутатор 123 | 10.207.64.0-10.207.95.255   | 19    |
| Коммутатор 124 | 10.207.96.0-10.207.127.255  | 19    |
| Коммутатор 125 | 10.207.128.0-10.207.159.255 | 19    |
| Коммутатор 126 | 10.207.160.0-10.207.191.255 | 19    |
| Коммутатор 127 | 10.207.207.0-10.207.223.255 | 19    |
| Коммутатор 128 | 10.207.224.0-10.207.255.255 | 19    |

В пределах сети коммутатора 1 у нас должно быть 128 подсетей с маской 26.
Получим следующую адресацию для сетей за коммутатором 1:

|           | Диапазон адресов            | Маска |
| --------- | --------------------------- | ----- |
| Отдел 1   | 10.192.0.0-10.192.0.63      | 26    |
| Отдел 2   | 10.192.0.64-10.192.0.127    | 26    |
| Отдел 3   | 10.192.0.128-10.192.0.191   | 26    |
| Отдел 4   | 10.192.0.192-10.192.0.255   | 26    |
| Отдел 5   | 10.192.1.0-10.192.1.63      | 26    |
| Отдел 6   | 10.192.1.64-10.192.1.127    | 26    |
| Отдел 7   | 10.192.1.128-10.192.1.191   | 26    |
| Отдел 8   | 10.192.1.192-10.192.1.255   | 26    |
| ---       | ---                         | ---   |
| Отдел 121 | 10.192.30.0-10.192.30.63    | 26    |
| Отдел 122 | 10.192.30.64-10.192.30.127  | 26    |
| Отдел 123 | 10.192.30.128-10.192.30.191 | 26    |
| Отдел 124 | 10.192.30.192-10.192.30.255 | 26    |
| Отдел 125 | 10.192.31.0-10.192.31.63    | 26    |
| Отдел 126 | 10.192.31.64-10.192.31.127  | 26    |
| Отдел 127 | 10.192.31.128-10.192.31.191 | 26    |
| Отдел 128 | 10.192.31.192-10.192.31.255 | 26    |

### Общая запись адреса, исходя из номера коммутатора и минимальной сети за ним

Сеть клиентских устройств за коммутаторами записывается следующим образом:

| Зафиксировано | Коммутатор | Отдел    | Хост   |
| ------------- | ---------- | -------- | ------ |
| 00001010.1100 | 0000.000   | 00000.00 | 000000 |

Например, если мы захотим узнать суммарную сеть за 121 коммутатором, то мы должны в адресе в поле коммутатора сформировать число 120. Получим:

| Зафиксировано | Коммутатор 121 | Отдел    | Хост   |
| ------------- | -------------- | -------- | ------ |
| 00001010.1100 | 1111.000       | 00000.00 | 000000 |


И далее, если мы хотим узнать адрес отдела 124, то мы должны в адресе в поле отдела сформировать число 123:

| Зафиксировано | Коммутатор 121 | Отдел    | Хост   |
| ------------- | -------------- | -------- | ------ |
| 00001010.1100 | 1111.000       | 11110.11 | 000000 |

В десятичном виде получаем 10.207.30.192. Адрес совпадает с тем, который должен быть - по составленной ранее таблице с коммутаторами видим, что суммарная подсеть за 121 коммутатором  10.207.0.0/19. И по таблице с отделами видим, что 124 отдел начинается с 30.192. Расчеты верны.

### Вывод

Сформирована адресация с учетом суммаризации подсетей на коммутаторах. Также есть возможность с помощью Wildcard-маски выделить один отдел, устройства которого подключены к разным коммутаторам.
